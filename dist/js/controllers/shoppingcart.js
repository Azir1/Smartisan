"use strict";$(function(){$(".navbar .list li").eq(0).click(function(){location.href="./index.html"});var l=localStorage.getItem("data");if(!Boolean(l)||"[]"==l)return $(".tb").html('<div>你的购物车还没有商品，快去<a href="./index.html">添加</a>吧！</div>'),!1;var t=(l=JSON.parse(l)).map(function(t){return t.id}).join(",");function p(){$(".num").each(function(t,e){var n=$(e).val()*$(e).parent().prev().children().text();n=n.toFixed(2),$(e).parent().next().children().text(n)});var n=0,a=0,r=0;$(".check").each(function(t,e){r+=+$(e).parent().siblings().eq(1).children(".num").val(),$(e).prop("checked")&&(a+=+$(e).parent().siblings().eq(2).text(),n+=+$(e).parent().siblings().eq(1).children(".num").val()),$(".total").text(a.toFixed(2)),$(".selected").text(n),$(".all").text(r)})}$.ajax({type:"post",url:"/shoppingcart",data:{id:t},dataType:"json",success:function(t){for(var n=t.data,e=n.length,a=function(e){c=l.filter(function(t){return t.id==n[e].id}),i=$('\n                    <tr class="product" id='+n[e].id+" price="+n[e].price+">\n                        <td>\n                            <input type=\"checkbox\" class='check'>\n                            <img src="+n[e].imgpath+"\n                                alt=\"\">\n                            <span class='name'>"+n[e].name+"</span>&nbsp;&nbsp;\n                            <span>"+n[e].introduce+"</span>\n                        </td>\n                        <td>\n                            <span class='price'>"+n[e].price+"</span>\n                        </td>\n                        <td>\n                            <span class=\"reduce\"></span>\n                            <input type='number' class='num' value="+c[0].num+'>\n                            <span class="plus"></span>\n                        </td>\n                        <td>\n                            <span>￥'+n[e].price*c[0].num+"</span>\n                        </td>\n                        <td>\n                            <span class='del'></span>\n                        </td>\n                    </tr>\n                    "),$(".tb").append(i)},r=0;r<e;r++){var c,i;a(r)}p(),$(".name").click(function(){var t=$(this).parent().parent().attr("id");location.href="./product.html?id="+t}),$('[type="checkbox"]').last().click(function(){$('[type="checkbox"]').last().prop("checked")?$('[type="checkbox"]').prop("checked",!0):$('[type="checkbox"]').prop("checked",!1),p()}),$(".check").click(function(){Array.from($(".check")).every(function(t){return $(t).prop("checked")})?$('[type="checkbox"]').last().prop("checked",!0):$('[type="checkbox"]').last().prop("checked",!1),p()}),$(".reduce").click(function(){var t=$(this).next().val();--t<=0&&(t=1),$(this).next().val(t);var e=$(this).parent().parent().attr("id"),n=l.findIndex(function(t){return t.id==e});l[n].num=t,localStorage.setItem("data",JSON.stringify(l)),p()}),$(".plus").click(function(){var t=$(this).prev().val();t=+t,10<=++t&&(t=10),$(this).prev().val(t);var e=$(this).parent().parent().attr("id"),n=l.findIndex(function(t){return t.id==e});l[n].num=t,localStorage.setItem("data",JSON.stringify(l)),p()}),$(".del").click(function(){var e=$(this).parent().parent().attr("id"),t=JSON.parse(localStorage.getItem("data")),n=t.findIndex(function(t){return t.id==e});t.splice(n,1),localStorage.setItem("data",JSON.stringify(t)),$(this).parent().parent().remove();var a=localStorage.getItem("data");0!=a.length&&"[]"!=a||$(".tb").html('<div>你的购物车还没有商品，快去<a href="./index.html">添加</a>吧！</div>'),p()}),$(".delAll").click(function(){$(".check").each(function(t,e){if($(e).prop("checked")){var n=localStorage.getItem("data");n=JSON.parse(n);var a=$(e).parent().parent().attr("id"),r=n.findIndex(function(t){return t.id==a});n.splice(r,1),localStorage.setItem("data",JSON.stringify(n)),$(e).parent().parent().remove(),0==(n=JSON.parse(localStorage.getItem("data"))).length&&$(".tb").html('<div>你的购物车还没有商品，快去<a href="./index.html">添加</a>吧！</div>')}p()})}),$(".account button").click(function(){var t=Array.from($(".check")).filter(function(t){return $(t).prop("checked")}).map(function(t){return $(t).parent().parent().attr("id")});if(0==t.length)return layer.msg("您还没选择任何商品"),!1;for(var e="",n=0;n<t.length;n++)e+="id="+t[n]+"&";e=e.substr(0,e.length-1),location.href="./order.html?"+e})}})});